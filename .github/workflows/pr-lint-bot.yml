name: Trigger lint format

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]
  workflow_call:
    inputs:
      COMMIT_MESSAGE:
        description: 'Commit message to prevent re-triggering the workflow'
        required: true
        type: string
        default: 'ðŸ¤– Lint code'

permissions:
  contents: write

jobs:
  format-code:
    if: '!contains(github.event.head_commit.message, github.event.inputs.COMMIT_MESSAGE)'
    name: Trigger lint bot
    uses: ./.github/workflows/lint-bot.yml
    secrets: inherit
    with:
      head-ref: ${{ github.event.pull_request.head.ref }}
      head-repo: ${{ github.event.pull_request.head.repo.full_name }}
      only-changed-files: true


  format-code-failed:
    runs-on: ubuntu-latest
    needs: format-code
    if: ${{ always() && contains(needs.*.result, 'failure') }}
    name: Acknowledge lint bot failure
    steps:
      - name: Acknowledge lint bot
        uses: peter-evans/create-or-update-comment@v3
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            :x: Ivy gardener failed to format your code.
          reactions: '-1'
          reactions-edit-mode: replace
          token: ${{ secrets.IVY_BRANCH_TOKEN }}
